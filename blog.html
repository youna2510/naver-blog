<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="prolog.css" />
    <title>SG Blog</title>

    <script>
      function popup() {
        var url = "./neighbor_request.html";
        var name = "_blank";
        var option =
          "width = 480, height = 300, top = 100, left = 200, location = no";
        window.open(url, name, option);
      }
    </script>
  </head>
  <body>
    <div id="top-area">
      <div class="top_menubar">
        <a
          id="bloghome-link"
          href="#"
          style="color: black; text-decoration-line: none"
          >ë¸”ë¡œê·¸ í™ˆ</a
        >
        <a style="color: gray"> | </a>
        <button id="login-btn" href="./login.html">ë¡œê·¸ì¸</button>
      </div>

      <div class="itemtitlefont" id="blogTitleName">ë¸”ë¡œê·¸ ì œëª©ì…ë‹ˆë‹¹</div>

      <div id="blog-menu">
        <div class="border">
          <table>
            <tbody>
              <tr>
                <td nowrap="nowrap" class="menu1">
                  <ul>
                    <li>
                      <a
                        id="prolog-link"
                        href="#"
                        style="color: black; text-decoration-line: none"
                        >í”„ë¡¤ë¡œê·¸</a
                      >
                    </li>
                    <li>|</li>
                    <li>
                      <a style="color: #861f1c; font-weight: bold">ë¸”ë¡œê·¸</a>
                    </li>
                  </ul>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <hr style="margin-left: 140px" />
    </div>

    <!--í”„ë¡œí•„-->
    <div class="bg-body">
      <div class="con">
        <p class="image">
          <a href="#">
            <img
              class="user-profilepicture"
              style="width: 135px"
              src="assets/profile.png"
              alt="í”„ë¡œí•„ ì´ë¯¸ì§€"
            />
          </a>
        </p>
      </div>
      <div class="name align">
        <div class="user-nickname" style="font-size: 15px">
          <strong class="itemfont col" id="nickNameArea">ì‚¬ìš©ìì´ë¦„</strong>
          <br />
          <span class="itemfont col">
            <span class="blog_domain col"> </span>
          </span>
        </div>
      </div>
      <p class="caption align">
        <span class="itemfont_col">í”„ë¡œí•„ ì†Œê°œ</span>
      </p>
      <p class="more align"><span class="m1"></span></p>
      <div class="btn_area" onclick="popup()">
        <a>
          <span class="blind">ì´ì›ƒì¶”ê°€</span>
        </a>
      </div>
    </div>

    <!--ì¹´í…Œê³ ë¦¬-->
    <div class="bg-category">
      <div>ì „ì²´ë³´ê¸°</div>
      <ul id="categoryList" class="category-list">
        ê²Œì‹œíŒ1
      </ul>
    </div>

    <!--ì„œë¡œì´ì›ƒ-->
    <div class="bg-neighbor">
      <div class="neighbor-profile">
        <div class="user-nickname" style="font-size: 15px">
          <strong>ì‚¬ìš©ì</strong>
        </div>
        <div>ì´ì›ƒ ì»¤ë„¥íŠ¸</div>
        <hr style="width: 100%; border: 0.25px solid gray" />
      </div>
      <div class="neighbor-list">
        <div style="display: none">
          <a class="find_neighbor">ë‚´ê°€ ì¶”ê°€í•œ</a
          ><a class="find_neighbor">ë‚˜ë¥¼ ì¶”ê°€í•œ</a>
        </div>
        <div class="all_neighborhood">
          <a>ì „ì²´ ì´ì›ƒ</a><a style="margin-left: 80px">57</a><a>ëª…</a>
        </div>
        <div style="display: inline-block">
          <div class="neighbor_img"><img /></div>
          <a class="neighbor_nickname" style="color: black; font-size: 3px"
            >ì´ì›ƒë³„ëª…</a
          >
        </div>
        <div style="display: inline-block">
          <div class="neighbor_img"><img /></div>
          <a class="neighbor_nickname">ì´ì›ƒë³„ëª…</a>
        </div>
        <div style="display: inline-block">
          <div class="neighbor_img"><img /></div>
          <a class="neighbor_nickname">ì´ì›ƒë³„ëª…</a>
        </div>
        <br />
        <div>
          <hr style="width: 80%; border: 0.25px solid gray" />
          <a
            class="user-nickname"
            style="margin-left: 10px; font-size: 13px; color: gray"
            ><strong>ë©˜ì•„</strong>ë‹˜ ì´ì›ƒì˜ ìƒˆê¸€ë³´ê¸° ></a
          >
        </div>
      </div>
    </div>

    <!--í¬ìŠ¤íŠ¸ ëª©ë¡-->
    <div class="pro_posts">
      <div class="post_list">
        <div class="post_list_title">
          <strong>ì „ì²´ë³´ê¸°</strong> <a>?ê°œì˜ ê¸€</a>
        </div>
        <div style="display: none" class="post_list_contents">
          <div class="post_list_content_title">
            <a>ê¸€ ì œëª©</a><a style="float: right">ì‘ì„±ì¼</a>
          </div>
          <hr class="post_list_hr" />
          <div class="post_list_contents_list">
            <div>
              <a>ê¸€ ì œëª©1</a><a style="float: right">2024.02.10</a>
              <hr class="post_list_contents_hr" />
            </div>
          </div>
        </div>
      </div>
      <div class="post_content"></div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", async function () {
        const urlParams = new URLSearchParams(window.location.search);
        const username = urlParams.get("user");
        const accessToken = localStorage.getItem("access_token");

        if (!username) {
          console.error("âŒ ì˜¤ë¥˜: usernameì´ ì—†ìŒ");
          updateBlogUI(null);
          return;
        }

        if (!accessToken) {
          console.warn("âš ï¸ ë¡œê·¸ì¸ í•„ìš”: access_token ì—†ìŒ");
          updateUserStatus(null);
        } else {
          const loggedInUser = await fetchUserInfo();
          updateUserStatus(loggedInUser);
        }

        // í”„ë¡œí•„ ë° ë¸”ë¡œê·¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const profileData = await fetchAPI(
          `profile/${encodeURIComponent(username)}/`
        );
        updateBlogUI(profileData);

        // ì¹´í…Œê³ ë¦¬ ê°€ì ¸ì˜¤ê¸°
        const categories = await fetchAPI(
          `category/?urlname=${encodeURIComponent(username)}`
        );
        updateCategoryUI(categories);

        // ì„œë¡œì´ì›ƒ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        const neighbors = await fetchAPI(
          `profile/${encodeURIComponent(username)}/neighbors/`
        );
        updateNeighborUI(neighbors);

        // í”„ë¡¤ë¡œê·¸ ë§í¬ ì„¤ì •
        setupPrologLink(username);
        setupBlogHomeLink(username);

        // ê²Œì‹œë¬¼ ê°€ì ¸ì˜¤ê¸°
        fetchPosts(); // `await` ì—†ì´ í˜¸ì¶œ
      });

      // ğŸ”¹ **API í˜¸ì¶œ í•¨ìˆ˜ (GET ìš”ì²­)**
      async function fetchAPI(endpoint) {
        try {
          const response = await fetch(`http://127.0.0.1:8000/${endpoint}`, {
            method: "GET",
            headers: {
              Accept: "application/json", // ì„œë²„ì—ì„œ ë°›ì•„ì˜¬ ë°ì´í„° í˜•ì‹
              Authorization: `Bearer ${localStorage.getItem("access_token")}`, // í† í° ì „ë‹¬
            },
          });

          if (!response.ok) {
            console.error(
              `âš ï¸ API ìš”ì²­ ì‹¤íŒ¨: ${endpoint} (ìƒíƒœ ì½”ë“œ: ${response.status})`
            );
            return null;
          }

          // ì‘ë‹µ ë°ì´í„°ê°€ categoriesë¥¼ í¬í•¨í•˜ê³  ìˆëŠ”ì§€ í™•ì¸
          const data = await response.json();
          return data; // ì‘ë‹µ ë°ì´í„° ë°˜í™˜
        } catch (error) {
          console.error(`âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜: ${endpoint}`, error);
          return null;
        }
      }

      // ğŸ”¹ **ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°**
      async function fetchUserInfo() {
        try {
          const accessToken = localStorage.getItem("access_token");
          if (!accessToken) return null;

          const response = await fetch("http://127.0.0.1:8000/profile/me/", {
            method: "GET",
            headers: {
              Authorization: `Bearer ${accessToken}`,
              "Content-Type": "application/json",
            },
          });

          if (response.status !== 200) {
            console.warn("âš ï¸ ì‚¬ìš©ì ì •ë³´ ìš”ì²­ ì‹¤íŒ¨ (401 Unauthorized)");
            return null;
          }

          return await response.json();
        } catch (error) {
          console.error("âŒ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:", error);
          return null;
        }
      }

      // ğŸ”¹ **ë¡œê·¸ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸**
      async function updateUserStatus() {
        const loginButton = document.querySelector(".login_btn");

        try {
          const accessToken = localStorage.getItem("access_token");

          if (!accessToken) {
            // ğŸ”¹ ë¡œê·¸ì¸ë˜ì§€ ì•Šì€ ê²½ìš°
            updateLoginButtonUI();
            return;
          }

          // ğŸ”¹ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
          const userResponse = await fetch(
            "http://127.0.0.1:8000/profile/me/",
            {
              method: "GET",
              headers: {
                Authorization: `Bearer ${accessToken}`,
                "Content-Type": "application/json",
              },
            }
          );

          if (userResponse.status !== 200) {
            console.error("âŒ ì‚¬ìš©ì ì •ë³´ ìš”ì²­ ì‹¤íŒ¨:", userResponse.status);
            updateLoginButtonUI(); // ë¡œê·¸ì¸ ë²„íŠ¼ UI ì—…ë°ì´íŠ¸
            return;
          }

          const userData = await userResponse.json();
          const loggedInUser = userData.username; // ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ë‹‰ë„¤ì„

          console.log("ğŸ”¹ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì:", loggedInUser);

          // ğŸ”¹ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ë²„íŠ¼ ë³€ê²½
          if (loginButton) {
            loginButton.textContent = loggedInUser; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
            loginButton.href = "./profile.html"; // í´ë¦­í•˜ë©´ í”„ë¡œí•„ í˜ì´ì§€ë¡œ ì´ë™í•˜ë„ë¡ ë³€ê²½
          }
        } catch (error) {
          console.error("ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:", error);
          updateLoginButtonUI(); // ë¡œê·¸ì¸ ë²„íŠ¼ UI ì—…ë°ì´íŠ¸
        }
      }

      // ğŸ”¹ ë¡œê·¸ì¸ë˜ì§€ ì•Šì•˜ì„ ë•Œ ë²„íŠ¼ ìƒíƒœ ë³€ê²½
      function updateLoginButtonUI() {
        const loginButton = document.querySelector(".login_btn");

        if (loginButton) {
          loginButton.textContent = "ë¡œê·¸ì¸ í•„ìš”"; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
          loginButton.href = "./login.html"; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ë„ë¡ ì„¤ì •
        }
      }

      // ğŸ”¹ í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
      document.addEventListener("DOMContentLoaded", updateUserStatus);

      // ğŸ”¹ **ë¸”ë¡œê·¸ UI ì—…ë°ì´íŠ¸**
      function updateBlogUI(profileData) {
        if (!profileData) {
          document.getElementById("blog-title").innerText =
            "ë¸”ë¡œê·¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
          document.getElementById("blog-intro").innerText =
            "ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
          return;
        }

        document
          .querySelectorAll(".user-nickname")
          .forEach((el) => (el.innerText = profileData.username || "ìµëª…"));
        document
          .querySelectorAll(".user-profilepicture")
          .forEach(
            (img) => (img.src = profileData.user_pic || "assets/profile.png")
          );
        document
          .querySelectorAll(".itemtitlefont")
          .forEach(
            (e2) => (e2.innerText = profileData.blog_name || "ë¸”ë¡œê·¸ëª…")
          );
        document
          .querySelectorAll(".itemfont_col")
          .forEach(
            (e3) =>
              (e3.innerText =
                profileData.intro || "ë¸”ë¡œê·¸ ì†Œê°œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.")
          );
      }

      // ğŸ”¹ **ì¹´í…Œê³ ë¦¬ UI ì—…ë°ì´íŠ¸**
      function updateCategoryUI(categories) {
        const list = document.getElementById("categoryList");
        if (!list) return;

        list.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

        // categoriesê°€ ë°°ì—´ì´ ì•„ë‹ ê²½ìš° ì²˜ë¦¬
        if (!categories || !Array.isArray(categories)) {
          list.innerHTML = "<li>ì¹´í…Œê³ ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>";
          return;
        }

        // ì¹´í…Œê³ ë¦¬ ë°ì´í„°ê°€ ë¹„ì–´ìˆì„ ê²½ìš° ì²˜ë¦¬
        if (categories.length === 0) {
          list.innerHTML = "<li>ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</li>";
          return;
        }

        categories.forEach((category) => {
          const li = document.createElement("li");
          li.textContent = category.name || "ì´ë¦„ ì—†ìŒ"; // category.nameì´ ì—†ì„ ê²½ìš° ê¸°ë³¸ê°’ ì„¤ì •
          list.appendChild(li);
        });
      }

      // ğŸ”¹ **ì„œë¡œì´ì›ƒ ëª©ë¡ UI ì—…ë°ì´íŠ¸**
      function updateNeighborUI(neighbors) {
        const neighborListContainer = document.querySelector(".neighbor-list");
        if (!neighborListContainer) return;

        neighborListContainer.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

        if (
          !neighbors ||
          !Array.isArray(neighbors.neighbors) ||
          neighbors.neighbors.length === 0
        ) {
          neighborListContainer.innerHTML =
            "<p>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspì•„ì§ ê³µê°œëœ<br>&nbsp&nbsp&nbspì„œë¡œì´ì›ƒì´ ì—†ìŠµë‹ˆë‹¤.</p>";
          return;
        }

        neighbors.neighbors.forEach((neighbor) => {
          const neighborDiv = document.createElement("div");
          neighborDiv.style.display = "inline-block";

          const neighborImgDiv = document.createElement("div");
          neighborImgDiv.classList.add("neighbor_img");
          const img = document.createElement("img");
          img.src = getFullMediaUrl(neighbor.user_pic);
          img.alt = "ì´ì›ƒ í”„ë¡œí•„";
          neighborImgDiv.appendChild(img);

          const neighborNickname = document.createElement("a");
          neighborNickname.classList.add("neighbor_nickname");
          neighborNickname.innerText = neighbor.urlname;
          neighborNickname.href = `blog.html?user=${encodeURIComponent(
            neighbor.urlname
          )}`;

          neighborDiv.appendChild(neighborImgDiv);
          neighborDiv.appendChild(neighborNickname);
          neighborListContainer.appendChild(neighborDiv);
        });
      }

      // ğŸ”¹ **í”„ë¡¤ë¡œê·¸ ë§í¬ ì„¤ì •**
      function setupPrologLink(username) {
        const prologLink = document.getElementById("prolog-link");
        if (prologLink) {
          prologLink.href = `prolog.html?user=${encodeURIComponent(username)}`;
        }
      }

      // ğŸ”¹ **ë¸”ë¡œê·¸ í™ˆ ì„¤ì •**
      function setupBlogHomeLink(username) {
        const BlogHomeLink = document.getElementById("bloghome-link");
        if (BlogHomeLink) {
          BlogHomeLink.href = `main_login.html?user=${encodeURIComponent(
            username
          )}`;
        }
      }

      // ğŸ”¹ **ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥**
      async function logout() {
        try {
          const refreshToken = localStorage.getItem("refresh_token");

          if (!refreshToken) {
            console.error("âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: refresh_token ì—†ìŒ");
            alert("ë¡œê·¸ì¸ ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤.");
            return;
          }

          console.log("ğŸ”¹ ë¡œê·¸ì•„ì›ƒ ìš”ì²­ ì „ refresh_token:", refreshToken);

          const response = await fetch("http://127.0.0.1:8000/logout/", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ refresh: refreshToken }),
          });

          console.log("ğŸ”¹ ë¡œê·¸ì•„ì›ƒ ì‘ë‹µ ìƒíƒœ ì½”ë“œ:", response.status);

          if (response.status === 200) {
            console.log("âœ… ë¡œê·¸ì•„ì›ƒ ì„±ê³µ");

            // ğŸ”¹ í† í° ì‚­ì œ
            localStorage.removeItem("access_token");
            localStorage.removeItem("refresh_token");

            alert("ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ!");

            // ğŸ”¹ ë¡œê·¸ì¸ ë²„íŠ¼ì„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
            updateLoginButtonUI();
          } else {
            console.error("âŒ ë¡œê·¸ì•„ì›ƒ ìš”ì²­ ì‹¤íŒ¨:", response.status);
            const errorData = await response.json();
            alert(`ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: ${errorData.message || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`);
          }
        } catch (error) {
          console.error("âŒ ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:", error);
          alert("ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
      }

      function updateLoginButtonUI() {
        const loginButton = document.querySelector(".login_btn");

        if (loginButton) {
          loginButton.textContent = "ë¡œê·¸ì¸ í•„ìš”"; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
          loginButton.href = "./login.html"; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ë„ë¡ ì„¤ì •
        }
      }

      // ğŸ”¹ **í”„ë¡œí•„ ì´ë¯¸ì§€ URL ì²˜ë¦¬**
      function getFullMediaUrl(relativeUrl) {
        return relativeUrl
          ? `http://127.0.0.1:8000${relativeUrl}`
          : "assets/default_profile.png";
      }

      document.addEventListener("DOMContentLoaded", async function () {
        const loginButton = document.querySelector(".top_menubar button");
        const accessToken = localStorage.getItem("access_token");

        if (accessToken) {
          try {
            // ğŸ”¹ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const response = await fetch("http://127.0.0.1:8000/profile/me/", {
              method: "GET",
              headers: {
                Authorization: `Bearer ${accessToken}`,
                "Content-Type": "application/json",
              },
            });

            if (response.ok) {
              const data = await response.json();
              const loggedInUser = data.username;

              // ğŸ”¹ ë²„íŠ¼ì„ ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ë³€ê²½ & í”„ë¡œí•„ í˜ì´ì§€ë¡œ ì´ë™
              loginButton.textContent = loggedInUser;
              loginButton.onclick = () =>
                (location.href = `profile.html?user=${encodeURIComponent(
                  loggedInUser
                )}`);
            } else {
              throw new Error("ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
          } catch (error) {
            console.error("âŒ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:", error);
            showLoginButton(); // ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ê±°ë‚˜ ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¡œê·¸ì¸ ë²„íŠ¼ ìœ ì§€
          }
        } else {
          showLoginButton(); // ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ì„ ê²½ìš° ê¸°ë³¸ ë¡œê·¸ì¸ ë²„íŠ¼ í‘œì‹œ
        }

        function showLoginButton() {
          loginButton.textContent = "ë¡œê·¸ì¸";
          loginButton.onclick = () => (location.href = "login.html");
        }
      });

      async function fetchPosts() {
        const urlParams = new URLSearchParams(window.location.search);
        const username = urlParams.get("user");

        if (!username) {
          console.error("ì‚¬ìš©ìëª…ì´ ì—†ìŠµë‹ˆë‹¤.");
          return;
        }

        const accessToken = localStorage.getItem("access_token");

        try {
          const response = await fetch(
            `http://127.0.0.1:8000/posts/?urlname=${encodeURIComponent(
              username
            )}`,
            {
              method: "GET",
              headers: {
                Authorization: `Bearer ${accessToken}`,
                Accept: "application/json",
              },
            }
          );

          const data = await response.json();

          if (!response.ok) {
            console.error("ê²Œì‹œë¬¼ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            return;
          }

          if (Array.isArray(data)) {
            renderPosts(data); // âœ… ë¶ˆëŸ¬ì˜¨ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ UI ìƒì„±
          } else {
            console.error("ê²Œì‹œê¸€ ëª©ë¡ì´ ë°°ì—´ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.");
          }
        } catch (error) {
          console.error("ğŸ“Œ ê²Œì‹œë¬¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:", error);
        }
      }

      function renderPosts(posts) {
        const postContainer = document.querySelector(".post_content");

        postContainer.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

        posts.forEach((post) => {
          const postElement = document.createElement("div");
          postElement.classList.add("post_item");

          // ğŸ”¹ ë‚ ì§œ í¬ë§· ë³€í™˜
          const formattedDate = new Date(post.created_at)
            .toLocaleString("ko-KR", {
              year: "numeric",
              month: "2-digit",
              day: "2-digit",
              hour: "2-digit",
              minute: "2-digit",
            })
            .replace(/\./g, "")
            .replace(" ", ". ")
            .replace("ì˜¤ì „", "")
            .replace("ì˜¤í›„", "")
            .trim();

          // ğŸ”¹ ë³¸ë¬¸ ë‚´ìš© ì •ë¦¬
          let cleanedContent = removeUnnecessaryButtons(post.content);
          cleanedContent = fixImageUrls(cleanedContent);

          // ğŸ”¹ ì´ë¯¸ì§€ ì¶”ê°€ (ë³¸ë¬¸ì— ì—†ëŠ” ê²½ìš°ë§Œ)
          if (post.images && post.images.length > 0) {
            post.images.forEach((imageData) => {
              const { image_url, caption } = imageData;

              // âœ… ê¸°ì¡´ <img> íƒœê·¸ê°€ ì—†ì„ ê²½ìš°ì—ë§Œ ì¶”ê°€
              if (!cleanedContent.includes(image_url)) {
                const imageTag = `
                        <figure style="text-align: center; margin: 15px 0px;">
                          <img src="${fixSingleImageUrl(
                            image_url
                          )}" class="editable-image"
                               style="max-width: 100%; height: auto; margin-top: 10px; border-radius: 5px;">
                          <figcaption style="font-size: 12px; color: gray; margin-top: 5px; text-align: center;">
                            ${caption || ""}
                          </figcaption>
                        </figure>
                      `;

                cleanedContent += imageTag;
              }
            });
          }

          // ğŸ”¹ ê²Œì‹œë¬¼ ì¹´ë“œ ìƒì„±
          postElement.innerHTML = `
                  <div class="post_title_content">
                      <div class="post_category">${post.category_name}</div>
                      <div class="post_title">${post.title}</div>
                      <div class="post_writer_list">
                          <strong class="user-nickname" style="color: black;">${post.user_name}</strong>
                          <a>${formattedDate}</a>
                      </div>
                      <hr class="post_hr">
                  </div>
                  <div class="post_contents">
                      ${cleanedContent}  <!-- âœ… ë³€í™˜ëœ content ì‚½ì… -->
                  </div>
                  <div class="post_last_list">
                      <a class="heart_list">ê³µê° ${post.total_likes}</a>
                      <a class="comment_list">ëŒ“ê¸€ ì“°ê¸°</a>
                  </div>
                `;

          postContainer.appendChild(postElement);
        });
      }

      function fixImageUrls(htmlContent) {
        const baseUrl = "http://127.0.0.1:8000";

        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = htmlContent;

        tempDiv.querySelectorAll("img").forEach((img) => {
          const imgSrc = img.getAttribute("src");

          if (imgSrc && !imgSrc.startsWith("http")) {
            img.src = baseUrl + imgSrc;
          }
        });

        return tempDiv.innerHTML;
      }

      function fixSingleImageUrl(imageUrl) {
        const baseUrl = "http://127.0.0.1:8000";
        return imageUrl.startsWith("http") ? imageUrl : baseUrl + imageUrl;
      }

      function removeUnnecessaryButtons(htmlContent) {
        const tempDiv = document.createElement("div");
        tempDiv.innerHTML = htmlContent;

        tempDiv.querySelectorAll("button").forEach((button) => {
          if (button.textContent.trim() === "ëŒ€í‘œì‚¬ì§„ ì„ íƒ") {
            button.remove();
          }
        });

        return tempDiv.innerHTML;
      }
    </script>
  </body>
</html>
