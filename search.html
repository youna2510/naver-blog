<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Naver Blog Project</title>
    <style>

        html, body {
            min-width:1280px;
            overflow-y:auto;
            overflow-x: auto;
        }

        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }

        

/*í—¤ë” ë¶€ë¶„*/        
        .header {
            display: flex;
            justify-content: space-between; /* ì¢Œìš°ë¡œ ê· ë“± ë°°ì¹˜ */
            align-items: center; /* ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ */
            padding: 5px 17%; /* ì¢Œìš° íŒ¨ë”© ì„¤ì • */
            background-color: #f1d1d3;
            color: white;
        }

        .header .logo {
            display: flex;
            align-items: center;
        }


        .header .logo {
            height: 49px; /* ê³ ì •ëœ ë¡œê³  í¬ê¸° */
            width: auto; /* ë¹„ìœ¨ ìœ ì§€ */
            margin: 1px; /* margin (ì´ë¯¸ì§€ë¥¼ ë‘˜ëŸ¬ì‹¸ëŠ” ì—¬ë°±ì˜ í­) ì œê±° */
            transition: margin-left 0.3s ease;
            font-size:27px;
            font-weight:800;

        }

        .header .search {
            display: flex;
            justify-content: center;
            align-items: center;
        }


        .header .search input {
            width: 60%; /* ê²€ìƒ‰ì°½ ë„ˆë¹„ */
            padding: 12px;
            border: none;
            border-radius: 0px;
            margin-right: 300px;
            border-color: #f1d1d3;

        }

        .header .search button { /*ìœ—ì¤„ ê²€ìƒ‰ ë²„íŠ¼*/
            padding: 11px 13px;
            border: none;
            background-color: #da9d9c;
            border-color: #da9d9c;
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            margin-left:-193px;
        }

        
        .header .search button:hover {
            background-color: #861f1c;
        }

        .header .menu {
            display: flex;
        }


        .header .menu button {
            background-color: #da9d9c;
            color: #fff;
            border: none;
            padding: 11px 16px;
            border-radius:2px;
            cursor: pointer;
            font-weight: bold;
        }

        .header .menu button:hover {
            background-color: #861f1c;
        }
        
        


        .search select {
            width:100%;
            padding:11.8px;
            border: 0.05px solid;
            border-color: #da9d9c;
            margin-right:20px;
        }
        
        

        .main-container {
            display: flex;
            justify-content: space-between;
            margin: 20px;
        }

        

 

/*ì™¼ìª½ ë¶€ë¶„*/
        .left-column {
            width: 100%;
            padding: 20px;
        }



/* ì¹´í…Œê³ ë¦¬ ë„¤ë¹„ê²Œì´ì…˜ */
        .category-nav {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .category-nav ul {
            list-style: none;
            display: flex;
            padding: 0;
            border-bottom: 2.5px solid #ddd;
            border-top: 2.5px solid #ddd;
        }

        .category-nav li {
            margin-right: 30px;
        }

        .category-nav a {
            display: block;
            padding: 10px 15px;
            font-size: 14px;
            color: black;
            text-decoration: none;
        }

        .category-nav a:hover, 
        .category-nav a.active {
            color: #861f1c;
            font-weight: bold;
            border-bottom: 3px solid #861f1c;
        }

/* ê¸€ ëª©ë¡ ìŠ¤íƒ€ì¼ */
        .post-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

/* ê°œë³„ ê¸€ */
        .post {
            background-color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

/* ì‘ì„±ì ì •ë³´ */
        .post-author {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .post-author img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }

        .author-name {
            font-size: 14px;
            font-weight: bold;
        }

        .time {
            font-size: 12px;
            color: gray;
            margin-top:6px;
        }

/* ê¸€ ë‚´ìš© */
        .post-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .post-text {
            flex: 1;
        }

        .post-text h3 {
            font-size: 18px;
            margin-bottom: 5px;
        }

        .post-text p {
            font-size: 14px;
            color: gray;
        }

        .post-meta {
            font-size: 12px;
            color: gray;
            margin-top:13px;
        }

        .post-content img {
            width: 120px;
            height: 80px;
            object-fit: cover;
            border-radius: 5px;
        }


    </style>
</head>

<body>
    <header class="header">
        <!-- ë¡œê³  -->
        <div class="logo">SG blog</div>

        <!-- ê²€ìƒ‰ ì˜ì—­ -->
        <div class="search">
            <div class="search-select">
                <label for="search-type" class="visually-hidden"></label>
                <select id="search-type" name="type">
                    <option value="geul">ê¸€</option>
                    <option value="blog">ë¸”ë¡œê·¸</option>
                    <option value="id">ë³„ëª…, ì•„ì´ë””</option>
                </select>
            </div>

            <div class="search-input">
                <label for="search-input" class="visually-hidden"></label>
                <input id="search-input" type="text" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
            </div>

            <button class="search-button">ê²€ìƒ‰</button>
        </div>

        <!-- ë©”ë‰´ ë²„íŠ¼ -->
        <div class="menu">
            <button onclick="location.href='login.html'">ë¡œê·¸ì¸</button>
        </div>
    </header>

    <div class="main-container">
        <div class="left-column">
 
        
            <!-- ì¹´í…Œê³ ë¦¬ ë„¤ë¹„ê²Œì´ì…˜ -->
            <nav class="category-nav">
                <ul>
                    <li><a class="active">ê¸€</a></li>
                    <li><a>ë¸”ë¡œê·¸</a></li>
                    <li><a>ë³„ëª… Â· ì•„ì´ë””</a></li>
                </ul>
            </nav>
        
            <!-- ì „ì²´ ê³µê°œëœ ê¸€ ëª©ë¡ -->
            <div class="post-list">
                <div class="post">
                    <div class="post-author">
                        <img src="assets/profile.png" alt="í”„ë¡œí•„">
                        <div>
                            <div class="author-name">ã…‡ã…‡</div>
                            <div class="time">7ì‹œê°„ ì „</div>
                        </div>
                    </div>
                    <div class="post-content">
                        <div class="post-text">
                            <h3>ì „ì²´ ì¹´í…Œê³ ë¦¬ ê¸€1</h3>
                            <p>ì•ˆë…•í•˜ì„¸ìš”!</p>
                            <div class="post-meta">
                                <span>ê³µê° 66</span> Â· <span>ëŒ“ê¸€ 18</span>
                            </div>
                        </div>
                        <img src="https://via.placeholder.com/120" alt="ëŒ€í‘œì‚¬ì§„">
                    </div>
                </div>
        
                <div class="post">
                    <div class="post-author">
                        <img src="assets/profile.png" alt="í”„ë¡œí•„">
                        <div>
                            <div class="author-name">ì‚¬ìš©ì</div>
                            <div class="time">9ì‹œê°„ ì „</div>
                        </div>
                    </div>
                    <div class="post-content">
                        <div class="post-text">
                            <h3>ì „ì²´ ì¹´í…Œê³ ë¦¬ ê¸€2</h3>
                            <p>ã…‡ã…‡ã…‡</p>
                            <div class="post-meta">
                                <span>ê³µê° 49</span> Â· <span>ëŒ“ê¸€ 3</span>
                            </div>
                        </div>
                        <img src="https://via.placeholder.com/120" alt="ëŒ€í‘œì‚¬ì§„">
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
document.querySelector('.search-button').addEventListener('click', async function() {
    const searchQuery = document.getElementById('search-input').value.trim();
    const searchType = document.getElementById('search-type').value;
    
    if (!searchQuery) {
        alert('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        return;
    }

    // ì¹´í…Œê³ ë¦¬ í™œì„±í™” ì—…ë°ì´íŠ¸ í•¨ìˆ˜ í˜¸ì¶œ
    updateActiveCategory(searchType);

    try {
        const response = await fetch(`http://127.0.0.1:8000/search/global-nickandid/?q=${encodeURIComponent(searchQuery)}`, {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${localStorage.getItem("access_token")}`,
                "Content-Type": "application/json",
            },
        });

        if (response.status === 200) {
            const data = await response.json();
            renderSearchResults(data);
        } else {
            console.error('ê²€ìƒ‰ ì˜¤ë¥˜ ë°œìƒ');
            alert('ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
        }
    } catch (error) {
        console.error('ê²€ìƒ‰ ì¤‘ ì—ëŸ¬ ë°œìƒ:', error);
        alert('ê²€ìƒ‰ ì¤‘ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
});

// ğŸŸ¢ ì¹´í…Œê³ ë¦¬ í™œì„±í™” ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updateActiveCategory(selectedType) {
    // ëª¨ë“  ì¹´í…Œê³ ë¦¬ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
    document.querySelectorAll('.category-nav a').forEach(link => {
        link.classList.remove('active');
    });

    // ì„ íƒëœ íƒ€ì…ì— ë§ëŠ” ë§í¬ì— active í´ë˜ìŠ¤ ì¶”ê°€
    let targetSelector = "";
    if (selectedType === "geul") {
        targetSelector = 'a[href="search_guel.html"]';
    } else if (selectedType === "blog") {
        targetSelector = 'a[href="search_blog.html"]';
    } else if (selectedType === "id") {
        targetSelector = 'a[href="search_id.html"]';
    }

    const targetElement = document.querySelector(targetSelector);
    if (targetElement) {
        targetElement.classList.add("active");
    }
}

// ğŸ”¹ í˜ì´ì§€ ë¡œë“œ ì‹œ URL íŒŒë¼ë¯¸í„°ì— ë”°ë¼ í™œì„±í™” ìƒíƒœ ì„¤ì •
document.addEventListener("DOMContentLoaded", function () {
    const urlParams = new URLSearchParams(window.location.search);
    const searchType = urlParams.get("type"); // URLì—ì„œ ê²€ìƒ‰ íƒ€ì… ê°€ì ¸ì˜¤ê¸°

    if (searchType) {
        updateActiveCategory(searchType); // ê²€ìƒ‰ íƒ€ì…ì— ë§ê²Œ active ì ìš©
    }
});

// ê²€ìƒ‰ ê²°ê³¼ ë Œë”ë§ í•¨ìˆ˜
function renderSearchResults(data) {
    const resultContainer = document.querySelector('.post-list');
    resultContainer.innerHTML = ''; // ì´ì „ ê²°ê³¼ ì§€ìš°ê¸°

    if (data.users.length === 0) {
        resultContainer.innerHTML = '<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        return;
    }

    // ì‚¬ìš©ì ì •ë³´ë¥¼ ë Œë”ë§
    data.users.forEach(user => {
        const userPost = document.createElement('div');
        userPost.classList.add('post');

        userPost.innerHTML = `
            <div class="post-author">
                <img src="http://127.0.0.1:8000${user.user_pic}" alt="í”„ë¡œí•„" width="40" height="40">
                <div>
                    <div class="author-name">${user.username}</div>
                    <div class="time">ì‚¬ìš©ì ID: ${user.urlname}</div>
                </div>
            </div>
            <div class="post-content">
                <div class="post-text">
                    <h3>${user.blog_name}</h3>
                    <p>${user.intro}</p>
                </div>
            </div>
        `;

        resultContainer.appendChild(userPost);
    });
}





document.addEventListener("DOMContentLoaded", async function () {
    const urlParams = new URLSearchParams(window.location.search);
    const searchQuery = urlParams.get("q");

    if (searchQuery) {
        document.getElementById('search-input').value = searchQuery; // ì…ë ¥ì°½ì—ë„ ìœ ì§€
        await searchUsers(searchQuery); // ê²€ìƒ‰ í•¨ìˆ˜ í˜¸ì¶œ
    }
});

async function searchUsers(query) {
    try {
        const accessToken = localStorage.getItem("access_token");
        if (!accessToken) {
            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            return;
        }

        const response = await fetch(`http://127.0.0.1:8000/search/global-nickandid/?q=${encodeURIComponent(query)}`, {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${accessToken}`,
                "Content-Type": "application/json"
            }
        });

        if (!response.ok) {
            throw new Error("ê²€ìƒ‰ ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
        }

        const data = await response.json();
        displaySearchResults(data.users);
    } catch (error) {
        console.error("âŒ ê²€ìƒ‰ ìš”ì²­ ì‹¤íŒ¨:", error);
        alert("ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
    }
}

    </script>
</body>
</html>
