<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="prolog.css" />
    <title>SG Blog</title>
    <style>
      .post-category {
        margin-top:15px;
        margin-left:13px;
        display: inline-block;
        font-weight: bold;
      }

      /* ê³µê°œ ë²”ìœ„ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
.post-range {
    display: inline-block;
    padding: 5px 12px;
    border: 1px solid #ccc;
    border-radius: 5px;
    font-size: 12px;
    font-weight: bold;
    background-color: white; /* ê¸°ë³¸ í°ìƒ‰ ë°°ê²½ */
    color: #333;
    text-align: center;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
}

/* ê³µê°œ ë²”ìœ„ë³„ ìƒ‰ìƒ */
.post-range.everyone { background-color: #f1f1f1; } /* ì „ì²´ */
.post-range.mutual { background-color: #d1e7dd; color: #155724; } /* ì„œë¡œì´ì›ƒ */
.post-range.me { background-color: #f8d7da; color: #721c24; } /* ë‚˜ë§Œ ë³´ê¸° */


      .post-title {
        margin-left : 13px;
        margin-top:-7px;
      }

      .post-author {
        margin-right:5px;
        margin-left : 13px;
        font-weight:600;
        font-size:15px;
        margin-bottom:15px;
      }

      .post-content {
        margin-top: 35px;
        margin-left:16px;
        font-size:17px;
      }

      .post-date {
        margin-right:10px;
      }

      .post-mutual {
    display: inline-block;
    padding: 5px 12px;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: white; /* í°ìƒ‰ ë°°ê²½ */
    font-size: 14px;
    font-weight: bold;
    color: #333;
    text-align: center;
    box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
}
      .neighbor-btn {
      display: inline-block;
      margin-left: auto; /* ì˜¤ë¥¸ìª½ ì •ë ¬ */
      padding: 5px 10px;
      font-size: 12px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      }

      .neighbor-btn:hover {
      background-color: #0056b3;
      }


    </style>

    <script>
      function popup() {
        var url = "./neighbor_request.html";
        var name = "_blank";
        var option =
          "width = 480, height = 300, top = 100, left = 200, location = no";
        window.open(url, name, option);
      }
    </script>
  </head>
  <body>
    <div id="top-area">
      <div class="top_menubar">
        <a
          id="bloghome-link"
          href="#"
          style="color: black; text-decoration-line: none"
          >ë¸”ë¡œê·¸ í™ˆ</a
        >
        <a style="color: gray"> | </a>
        <button id="login-btn" href="./login.html">ë¡œê·¸ì¸</button>
      </div>


      <div id="blog-menu">
        <div class="border">
          <table>
            <tbody>
              <tr>
                <td nowrap="nowrap" class="menu1">
                  <ul>
                    <li>
                      <a
                        id="prolog-link"
                        href="#"
                        style="color: black; text-decoration-line: none"
                        >í”„ë¡¤ë¡œê·¸</a
                      >
                    </li>
                    <li>|</li>
                    <li>
                      <a style="color: #861f1c; font-weight: bold">ë¸”ë¡œê·¸</a>
                    </li>
                  </ul>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <hr style="margin-left: 140px" />
    </div>

    <!--í”„ë¡œí•„ (ê¸€ ì‘ì„±ìì˜ í”„ë¡œí•„ë¡œ ë³€ê²½)-->
<div class="bg-body">
  <div class="con">
    <p class="image">
      <a href="#">
        <img
          class="user-profilepicture"
          style="width: 135px"
          src="assets/profile.png"
          alt="í”„ë¡œí•„ ì´ë¯¸ì§€"
        />
      </a>
    </p>
  </div>
  <div class="name align">
    <div class="user-nickname" style="font-size: 15px">
      <strong class="itemfont col" id="nickNameArea">ì‚¬ìš©ìì´ë¦„</strong>
    </div>
  </div>
  <p class="caption align">
    <span class="itemfont_col" id="profile-intro">í”„ë¡œí•„ ì†Œê°œ</span>
  </p>
</div>

<!--ì¹´í…Œê³ ë¦¬ (ê¸€ ì‘ì„±ìì˜ ë°ì´í„°ë¡œ ë³€ê²½)-->
<div class="bg-category">
  <div>ì „ì²´ë³´ê¸°</div>
  <ul id="categoryList" class="category-list"></ul> <!-- ê¸°ì¡´ ë‚´ìš© ì œê±° -->
</div>

<!--ì„œë¡œì´ì›ƒ (ê¸€ ì‘ì„±ìì˜ ì„œë¡œì´ì›ƒìœ¼ë¡œ ë³€ê²½)-->
<div class="bg-neighbor">
  <div class="neighbor-profile">
    <div class="user-nickname" style="font-size: 15px">
      <strong>ì´ì›ƒ ëª©ë¡</strong>
    </div>
    <hr style="width: 100%; border: 0.25px solid gray" />
  </div>
  <div class="neighbor-list"></div> <!-- ê¸°ì¡´ ë‚´ìš© ì œê±° -->
</div>
      
    <div class="pro_posts">
      <div class="post_list">
          <div class="post_list_title">
  
              <!-- ğŸ”¹ ê²Œì‹œë¬¼ ì œëª© -->
              <h1 class="post-title"></h1>
  
              <!-- ğŸ”¹ ì‘ì„±ì ì •ë³´ -->
              <span class="post-author"></span>
              <span class="post-date"></span>
  
              <!-- ğŸ”¹ ì¹´í…Œê³ ë¦¬ + ì„œë¡œì´ì›ƒ ìƒíƒœë¥¼ í•œ ì¤„ë¡œ ì •ë ¬ -->
              <div class="post-meta" style="display: flex; align-items: center; justify-content: space-between;">
                  <div>
                      <span class="post-category"></span> <!-- ì¹´í…Œê³ ë¦¬ -->
                      <span class="post-range"></span> <!-- ê³µê°œ ë²”ìœ„ -->
                  </div>
                  <span class="post-mutual">ì„œë¡œì´ì›ƒ</span> <!-- ì„œë¡œì´ì›ƒ í‘œì‹œ -->
              </div>
  
              <hr class="post_hr">
  
              <!-- ğŸ”¹ ê²Œì‹œë¬¼ ë³¸ë¬¸ -->
              <div class="post-content"></div>
  
          </div>
      </div>
  </div>


    <script>
      // ğŸ”¹ **API í˜¸ì¶œ í•¨ìˆ˜ (GET ìš”ì²­)**
async function fetchAPI(endpoint) {
    try {
        const response = await fetch(`http://127.0.0.1:8000/${endpoint}`, {
            method: "GET",
            headers: {
                Accept: "application/json",
                Authorization: `Bearer ${localStorage.getItem("access_token")}`,
            },
        });

        if (!response.ok) {
            console.error(`âš ï¸ API ìš”ì²­ ì‹¤íŒ¨: ${endpoint} (ìƒíƒœ ì½”ë“œ: ${response.status})`);
            return null;
        }

        return await response.json();
    } catch (error) {
        console.error(`âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜: ${endpoint}`, error);
        return null;
    }
}


document.addEventListener("DOMContentLoaded", async function () {
    // âœ… `fetchAPI()`ê°€ ì •ì˜ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
    if (typeof fetchAPI !== "function") {
        console.error("âŒ fetchAPIê°€ ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í•¨ìˆ˜ê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.");
        return;
    }

    const accessToken = localStorage.getItem("access_token");

    if (!accessToken) {
        console.warn("âš ï¸ ë¡œê·¸ì¸ í•„ìš”: access_token ì—†ìŒ");
        updateUserStatus(null);
        return;
    }

    // âœ… 1. ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    const loggedInUser = await fetchUserInfo();

    if (!loggedInUser) {
        console.error("âŒ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨ (ë¡œê·¸ì¸ í•„ìš”)");
        updateUserStatus(null);
        return;
    }

    console.log("âœ… ë¡œê·¸ì¸í•œ ì‚¬ìš©ì:", loggedInUser.username);

    updateUserStatus(loggedInUser);

    // âœ… 2. ë¡œê·¸ì¸í•œ ì‚¬ìš©ì urlname ê°€ì ¸ì˜¤ê¸°
    const loggedInUrlname = loggedInUser?.urlname;
    if (!loggedInUrlname) {
        console.error("âŒ ë¡œê·¸ì¸í•œ ì‚¬ìš©ì urlnameì´ ì—†ìŒ");
        return;
    }
    console.log("ğŸ”¹ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ urlname:", loggedInUrlname);

    // âœ… 3. í”„ë¡œí•„ ë° ë¸”ë¡œê·¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
    const profileData = await fetchAPI(`profile/${encodeURIComponent(loggedInUrlname)}/`);
    if (profileData) {
        updateBlogUI(profileData);
    } else {
        console.error("âŒ í”„ë¡œí•„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }

    // âœ… 4. ì¹´í…Œê³ ë¦¬ ê°€ì ¸ì˜¤ê¸°
    const categories = await fetchAPI(`category/?urlname=${encodeURIComponent(loggedInUrlname)}`);
    if (categories) {
        updateCategoryUI(categories);
    }

    // âœ… 5. ì„œë¡œì´ì›ƒ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
    const neighbors = await fetchAPI(`profile/${encodeURIComponent(loggedInUrlname)}/neighbors/`);
    if (neighbors) {
        updateNeighborUI(neighbors);
    }

    // âœ… 6. í”„ë¡¤ë¡œê·¸ ë§í¬ ì„¤ì •
    setupPrologLink(loggedInUrlname);
    setupBlogHomeLink(loggedInUrlname);

    // âœ… 7. ê²Œì‹œë¬¼ ê°€ì ¸ì˜¤ê¸°
    fetchPosts();
});


// ğŸ”¹ **ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°**
async function fetchUserInfo() {
    try {
        const accessToken = localStorage.getItem("access_token");
        if (!accessToken) return null;

        const response = await fetch("http://127.0.0.1:8000/profile/me/", {
            method: "GET",
            headers: {
                Authorization: `Bearer ${accessToken}`,
                "Content-Type": "application/json",
            },
        });

        if (!response.ok) {
            console.warn("âš ï¸ ì‚¬ìš©ì ì •ë³´ ìš”ì²­ ì‹¤íŒ¨ (401 Unauthorized)");
            return null;
        }

        return await response.json();
    } catch (error) {
        console.error("âŒ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:", error);
        return null;
    }
}



// ğŸ”¹ **ë¡œê·¸ì¸ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜**
function updateUserStatus(user) {
    const loginButton = document.querySelector(".login_btn");

    if (!user || !user.username) {  // ğŸ”¥ userê°€ nullì´ê±°ë‚˜ usernameì´ ì—†ì„ ê²½ìš° ì²˜ë¦¬
        console.warn("âš ï¸ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìê°€ ì—†ìŒ, ê¸°ë³¸ UI í‘œì‹œ");
        updateLoginButtonUI();
        return;
    }

    console.log("âœ… ë¡œê·¸ì¸í•œ ì‚¬ìš©ì ì •ë³´:", user); // ğŸ”¥ ì „ì²´ ê°ì²´ë¥¼ ì¶œë ¥ (usernameì´ undefinedì¼ ê²½ìš° í™•ì¸ ê°€ëŠ¥)

    if (loginButton) {
        loginButton.textContent = user.username; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
        loginButton.href = "./profile.html"; // í´ë¦­í•˜ë©´ í”„ë¡œí•„ í˜ì´ì§€ë¡œ ì´ë™
    }
}


// ğŸ”¹ ë¡œê·¸ì¸ë˜ì§€ ì•Šì•˜ì„ ë•Œ ë²„íŠ¼ ìƒíƒœ ë³€ê²½
function updateLoginButtonUI() {
    const loginButton = document.querySelector(".login_btn");

    if (loginButton) {
        loginButton.textContent = "ë¡œê·¸ì¸ í•„ìš”"; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
        loginButton.href = "./login.html"; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ë„ë¡ ì„¤ì •
    }
}

// ğŸ”¹ **ë¸”ë¡œê·¸ UI ì—…ë°ì´íŠ¸**
function updateBlogUI(profileData) {
    if (!profileData) {
        console.error("âŒ ë¸”ë¡œê·¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    document.querySelector(".user-nickname").innerText = profileData.username || "ìµëª…";
    document.querySelector(".user-profilepicture").src = profileData.user_pic || "assets/profile.png";
    document.querySelector(".itemtitlefont").innerText = profileData.blog_name || "ë¸”ë¡œê·¸ëª…";
    document.querySelector(".itemfont_col").innerText = profileData.intro || "ë¸”ë¡œê·¸ ì†Œê°œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.";
}

function updateCategoryUI(categories) {
    const categoryListContainer = document.getElementById("categoryList");

    if (!categoryListContainer) {
        console.error("âŒ 'categoryList' ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    categoryListContainer.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

    if (!categories || categories.length === 0) {
        categoryListContainer.innerHTML = "<li>ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</li>";
        return;
    }

    categories.forEach(category => {
        const li = document.createElement("li");
        li.textContent = category.name;
        li.style.display = "block";  // í•œ í•­ëª©ì”© ìƒˆë¡œìš´ ì¤„ì— í‘œì‹œë˜ë„ë¡ ì„¤ì •
        categoryListContainer.appendChild(li);
    });
}


// ğŸ”¹ **ì„œë¡œì´ì›ƒ ëª©ë¡ UI ì—…ë°ì´íŠ¸**
function updateNeighborUI(neighbors) {
    const neighborListContainer = document.querySelector(".neighbor-list");
    if (!neighborListContainer) return;

    neighborListContainer.innerHTML = "";

    if (!neighbors || !Array.isArray(neighbors.neighbors) || neighbors.neighbors.length === 0) {
        neighborListContainer.innerHTML = "<p>ì•„ì§ ê³µê°œëœ ì„œë¡œì´ì›ƒì´ ì—†ìŠµë‹ˆë‹¤.</p>";
        return;
    }

    neighbors.neighbors.forEach((neighbor) => {
        const neighborDiv = document.createElement("div");
        neighborDiv.style.display = "inline-block";

        const neighborImgDiv = document.createElement("div");
        neighborImgDiv.classList.add("neighbor_img");
        const img = document.createElement("img");
        img.src = getFullMediaUrl(neighbor.user_pic);
        img.alt = "ì´ì›ƒ í”„ë¡œí•„";
        neighborImgDiv.appendChild(img);

        const neighborNickname = document.createElement("a");
        neighborNickname.classList.add("neighbor_nickname");
        neighborNickname.innerText = neighbor.urlname;
        neighborNickname.href = `blog.html?user=${encodeURIComponent(neighbor.urlname)}`;

        neighborDiv.appendChild(neighborImgDiv);
        neighborDiv.appendChild(neighborNickname);
        neighborListContainer.appendChild(neighborDiv);
    });
}

// ğŸ”¹ **í”„ë¡¤ë¡œê·¸ ë§í¬ ì„¤ì •**
function setupPrologLink(username) {
    const prologLink = document.getElementById("prolog-link");
    if (prologLink) {
        prologLink.href = `prolog.html?user=${encodeURIComponent(username)}`;
    }
}

// ğŸ”¹ **ë¸”ë¡œê·¸ í™ˆ ì„¤ì •**
function setupBlogHomeLink(username) {
    const BlogHomeLink = document.getElementById("bloghome-link");
    if (BlogHomeLink) {
        BlogHomeLink.href = `main_login.html?user=${encodeURIComponent(username)}`;
    }
}

// ğŸ”¹ **í”„ë¡œí•„ ì´ë¯¸ì§€ URL ì²˜ë¦¬ (defaultì™€ media ê²½ë¡œ ë¶„ë¦¬)**
function getFullMediaUrl(userPic) {
    if (!userPic || userPic.includes("default_profile.png")) {
        return "assets/default_profile.png"; // ê¸°ë³¸ í”„ë¡œí•„ ì´ë¯¸ì§€
    }

    // `userPic`ì´ `http://` ë˜ëŠ” `/media/`ë¡œ ì‹œì‘í•˜ëŠ” ê²½ìš° ê·¸ëŒ€ë¡œ ì‚¬ìš©
    if (userPic.startsWith("http") || userPic.startsWith("/media/")) {
        return `http://127.0.0.1:8000${userPic}`;
    }

    // `userPic`ì´ main/media/user_pics/{id}/... í˜•íƒœì¸ ê²½ìš°
    if (userPic.includes("user_pics/")) {
        return `http://127.0.0.1:8000/main/media/${userPic}`;
    }

    // ê·¸ ì™¸ì˜ ê²½ìš° ê¸°ë³¸ URL ì¶”ê°€
    return `http://127.0.0.1:8000${userPic}`;
}



      // ğŸ”¹ í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
      document.addEventListener("DOMContentLoaded", updateUserStatus);

      // ğŸ”¹ **ë¸”ë¡œê·¸ UI ì—…ë°ì´íŠ¸**
      function updateBlogUI(profileData) {
        if (!profileData) {
          document.getElementById("blog-title").innerText =
            "ë¸”ë¡œê·¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
          document.getElementById("blog-intro").innerText =
            "ì‚¬ìš©ì ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
          return;
        }

        document
          .querySelectorAll(".user-nickname")
          .forEach((el) => (el.innerText = profileData.username || "ìµëª…"));
        document
          .querySelectorAll(".user-profilepicture")
          .forEach(
            (img) => (img.src = profileData.user_pic || "assets/profile.png")
          );
        document
          .querySelectorAll(".itemtitlefont")
          .forEach(
            (e2) => (e2.innerText = profileData.blog_name || "ë¸”ë¡œê·¸ëª…")
          );
        document
          .querySelectorAll(".itemfont_col")
          .forEach(
            (e3) =>
              (e3.innerText =
                profileData.intro || "ë¸”ë¡œê·¸ ì†Œê°œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.")
          );
      }

      // ğŸ”¹ **ì¹´í…Œê³ ë¦¬ UI ì—…ë°ì´íŠ¸**
      function updateCategoryUI(categories) {
        const list = document.getElementById("categoryList");
        if (!list) return;

        list.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

        // categoriesê°€ ë°°ì—´ì´ ì•„ë‹ ê²½ìš° ì²˜ë¦¬
        if (!categories || !Array.isArray(categories)) {
          list.innerHTML = "<li>ì¹´í…Œê³ ë¦¬ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</li>";
          return;
        }

        // ì¹´í…Œê³ ë¦¬ ë°ì´í„°ê°€ ë¹„ì–´ìˆì„ ê²½ìš° ì²˜ë¦¬
        if (categories.length === 0) {
          list.innerHTML = "<li>ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</li>";
          return;
        }

        categories.forEach((category) => {
          const li = document.createElement("li");
          li.textContent = category.name || "ì´ë¦„ ì—†ìŒ"; // category.nameì´ ì—†ì„ ê²½ìš° ê¸°ë³¸ê°’ ì„¤ì •
          list.appendChild(li);
        });
      }

      // ğŸ”¹ **ì„œë¡œì´ì›ƒ ëª©ë¡ UI ì—…ë°ì´íŠ¸**
      function updateNeighborUI(neighbors) {
        const neighborListContainer = document.querySelector(".neighbor-list");
        if (!neighborListContainer) return;

        neighborListContainer.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

        if (
          !neighbors ||
          !Array.isArray(neighbors.neighbors) ||
          neighbors.neighbors.length === 0
        ) {
          neighborListContainer.innerHTML =
            "<p>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbspì•„ì§ ê³µê°œëœ<br>&nbsp&nbsp&nbspì„œë¡œì´ì›ƒì´ ì—†ìŠµë‹ˆë‹¤.</p>";
          return;
        }

        neighbors.neighbors.forEach((neighbor) => {
          const neighborDiv = document.createElement("div");
          neighborDiv.style.display = "inline-block";

          const neighborImgDiv = document.createElement("div");
          neighborImgDiv.classList.add("neighbor_img");
          const img = document.createElement("img");
          img.src = getFullMediaUrl(neighbor.user_pic);
          img.alt = "ì´ì›ƒ í”„ë¡œí•„";
          neighborImgDiv.appendChild(img);

          const neighborNickname = document.createElement("a");
          neighborNickname.classList.add("neighbor_nickname");
          neighborNickname.innerText = neighbor.urlname;
          neighborNickname.href = `blog.html?user=${encodeURIComponent(
            neighbor.urlname
          )}`;

          neighborDiv.appendChild(neighborImgDiv);
          neighborDiv.appendChild(neighborNickname);
          neighborListContainer.appendChild(neighborDiv);
        });
      }

      // ğŸ”¹ **í”„ë¡¤ë¡œê·¸ ë§í¬ ì„¤ì •**
      function setupPrologLink(username) {
        const prologLink = document.getElementById("prolog-link");
        if (prologLink) {
          prologLink.href = `prolog.html?user=${encodeURIComponent(username)}`;
        }
      }

      // ğŸ”¹ **ë¸”ë¡œê·¸ í™ˆ ì„¤ì •**
      function setupBlogHomeLink(username) {
        const BlogHomeLink = document.getElementById("bloghome-link");
        if (BlogHomeLink) {
          BlogHomeLink.href = `main_login.html?user=${encodeURIComponent(
            username
          )}`;
        }
      }

      // ğŸ”¹ **ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥**
      async function logout() {
        try {
          const refreshToken = localStorage.getItem("refresh_token");

          if (!refreshToken) {
            console.error("âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: refresh_token ì—†ìŒ");
            alert("ë¡œê·¸ì¸ ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤.");
            return;
          }

          console.log("ğŸ”¹ ë¡œê·¸ì•„ì›ƒ ìš”ì²­ ì „ refresh_token:", refreshToken);

          const response = await fetch("http://127.0.0.1:8000/logout/", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ refresh: refreshToken }),
          });

          console.log("ğŸ”¹ ë¡œê·¸ì•„ì›ƒ ì‘ë‹µ ìƒíƒœ ì½”ë“œ:", response.status);

          if (response.status === 200) {
            console.log("âœ… ë¡œê·¸ì•„ì›ƒ ì„±ê³µ");

            // ğŸ”¹ í† í° ì‚­ì œ
            localStorage.removeItem("access_token");
            localStorage.removeItem("refresh_token");

            alert("ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ!");

            // ğŸ”¹ ë¡œê·¸ì¸ ë²„íŠ¼ì„ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
            updateLoginButtonUI();
          } else {
            console.error("âŒ ë¡œê·¸ì•„ì›ƒ ìš”ì²­ ì‹¤íŒ¨:", response.status);
            const errorData = await response.json();
            alert(`ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: ${errorData.message || "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`);
          }
        } catch (error) {
          console.error("âŒ ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:", error);
          alert("ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
      }

      function updateLoginButtonUI() {
        const loginButton = document.querySelector(".login_btn");

        if (loginButton) {
          loginButton.textContent = "ë¡œê·¸ì¸ í•„ìš”"; // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
          loginButton.href = "./login.html"; // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ë„ë¡ ì„¤ì •
        }
      }

      // ğŸ”¹ **í”„ë¡œí•„ ì´ë¯¸ì§€ URL ì²˜ë¦¬**
      function getFullMediaUrl(relativeUrl) {
        return relativeUrl
          ? `http://127.0.0.1:8000${relativeUrl}`
          : "assets/default_profile.png";
      }

      document.addEventListener("DOMContentLoaded", async function () {
        const loginButton = document.querySelector(".top_menubar button");
        const accessToken = localStorage.getItem("access_token");

        if (accessToken) {
          try {
            // ğŸ”¹ ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
            const response = await fetch("http://127.0.0.1:8000/profile/me/", {
              method: "GET",
              headers: {
                Authorization: `Bearer ${accessToken}`,
                "Content-Type": "application/json",
              },
            });

            if (response.ok) {
              const data = await response.json();
              const loggedInUser = data.username;

              // ğŸ”¹ ë²„íŠ¼ì„ ì‚¬ìš©ì ì´ë¦„ìœ¼ë¡œ ë³€ê²½ & í”„ë¡œí•„ í˜ì´ì§€ë¡œ ì´ë™
              loginButton.textContent = loggedInUser;
              loginButton.onclick = () =>
                (location.href = `profile.html?user=${encodeURIComponent(
                  loggedInUser
                )}`);
            } else {
              throw new Error("ì‚¬ìš©ì ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            }
          } catch (error) {
            console.error("âŒ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:", error);
            showLoginButton(); // ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ê±°ë‚˜ ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¡œê·¸ì¸ ë²„íŠ¼ ìœ ì§€
          }
        } else {
          showLoginButton(); // ë¡œê·¸ì¸ ì •ë³´ê°€ ì—†ì„ ê²½ìš° ê¸°ë³¸ ë¡œê·¸ì¸ ë²„íŠ¼ í‘œì‹œ
        }

        function showLoginButton() {
          loginButton.textContent = "ë¡œê·¸ì¸";
          loginButton.onclick = () => (location.href = "login.html");
        }
      });

      

     
      async function fetchPosts() {
    const loggedInUser = await fetchUserInfo();
    const username = loggedInUser?.urlname;

    if (!username) {
        console.error("âŒ ì‚¬ìš©ìëª…ì´ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    console.log("ğŸ”¹ ê²Œì‹œë¬¼ ìš”ì²­í•  ì‚¬ìš©ìëª…:", username);

    const accessToken = localStorage.getItem("access_token");

    try {
        const response = await fetch(
            `http://127.0.0.1:8000/posts/?urlname=${encodeURIComponent(username)}`,
            {
                method: "GET",
                headers: {
                    Authorization: `Bearer ${accessToken}`,
                    Accept: "application/json",
                },
            }
        );

        const data = await response.json();
        console.log("ğŸ“¢ ì„œë²„ ì‘ë‹µ ë°ì´í„°:", data); // ğŸ”¥ ë°±ì—”ë“œì—ì„œ ë°›ì€ ë°ì´í„° í™•ì¸

        if (!response.ok) {
            console.error("âŒ ê²Œì‹œë¬¼ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
            return;
        }

        if (Array.isArray(data) && data.length > 0) {
            console.log("âœ… ê²Œì‹œë¬¼ ë°ì´í„°:", data);
            renderPosts(data);
        } else {
            console.warn("âš ï¸ ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤. (ì„œë²„ ì‘ë‹µ: ë¹ˆ ë°°ì—´)");
        }
    } catch (error) {
        console.error("ğŸ“Œ ê²Œì‹œë¬¼ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:", error);
    }
}

// ğŸ”¹ **ì˜¬ë°”ë¥¸ ì´ë¯¸ì§€ URL ë°˜í™˜ í•¨ìˆ˜ (5500 â†’ 8000 ë³€í™˜)**
function getValidImageUrl(image) {
    if (!image || image === "null") {
        return "assets/default_image.png"; // ê¸°ë³¸ ì´ë¯¸ì§€
    }

    if (image.startsWith("/media/")) {
        return `http://127.0.0.1:8000${image}`; // ğŸ”¥ ìƒëŒ€ ê²½ë¡œ â†’ ì ˆëŒ€ ê²½ë¡œ ë³€í™˜
    }

    return image;
}

// ğŸ”¹ **ë³¸ë¬¸ ë‚´ ì´ë¯¸ì§€ URLì„ ìë™ ë³€í™˜í•˜ëŠ” í•¨ìˆ˜**
function fixImageUrls(htmlContent) {
    const baseUrl = "http://127.0.0.1:8000";

    const tempDiv = document.createElement("div");
    tempDiv.innerHTML = htmlContent;

    tempDiv.querySelectorAll("img").forEach((img) => {
        const imgSrc = img.getAttribute("src");

        if (imgSrc && imgSrc.startsWith("/media/")) {
            img.src = baseUrl + imgSrc;
        }
    });

    return tempDiv.innerHTML;
}

// ğŸ”¹ **ê²Œì‹œë¬¼ ë Œë”ë§ í•¨ìˆ˜**
function renderPosts(posts) {
    const postContainer = document.querySelector(".post_content");

    if (!postContainer) {
        console.error("âŒ 'post_content' í´ë˜ìŠ¤ë¥¼ ê°€ì§„ ìš”ì†Œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        return;
    }

    postContainer.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

    posts.forEach((post) => {
        // ğŸ”¹ ë‚ ì§œ í¬ë§· ë³€í™˜
        const formattedDate = new Date(post.created_at)
            .toLocaleString("ko-KR", {
                year: "numeric",
                month: "2-digit",
                day: "2-digit",
                hour: "2-digit",
                minute: "2-digit",
            })
            .replace(/\./g, "")
            .replace(" ", ". ")
            .replace("ì˜¤ì „", "")
            .replace("ì˜¤í›„", "")
            .trim();

        // ğŸ”¹ ë³¸ë¬¸ ë‚´ìš© ì •ë¦¬
        let cleanedContent = removeUnnecessaryButtons(post.content);
        cleanedContent = fixImageUrls(cleanedContent); // ğŸ”¥ ë³¸ë¬¸ ë‚´ ì´ë¯¸ì§€ URL ë³€í™˜ ì ìš©

        // ğŸ”¹ ëŒ€í‘œ ì´ë¯¸ì§€ ê°€ì ¸ì˜¤ê¸° (ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ ì´ë¯¸ì§€)
        const imageUrl = getValidImageUrl(
            post.images?.find(img => img.is_representative)?.image_url || post.images?.[0]?.image_url
        );

        // ğŸ”¹ ì´ë¯¸ì§€ ì¤‘ë³µ ì¶”ê°€ ë°©ì§€ (ë³¸ë¬¸ ë‚´ img íƒœê·¸ í™•ì¸)
        if (post.images && post.images.length > 0 && !cleanedContent.includes(imageUrl)) {
            const imageTag = `
                <figure style="text-align: center; margin: 15px 0px;">
                    <img src="${imageUrl}" class="editable-image"
                        style="max-width: 100%; height: auto; margin-top: 10px; border-radius: 5px;">
                    <figcaption style="font-size: 12px; color: gray; margin-top: 5px; text-align: center;">
                        ${post.images[0].caption || ""}
                    </figcaption>
                </figure>
            `;
            cleanedContent += imageTag;
        }

        // ğŸ”¹ ê²Œì‹œê¸€ ìš”ì†Œ ìƒì„±
        const postElement = document.createElement("div");
        postElement.classList.add("post_item");

        postElement.innerHTML = `
            <h3>${post.title}</h3>
            <p>${cleanedContent}</p>
            <small>ì‘ì„±ì: ${post.user_name} | ë‚ ì§œ: ${formattedDate}</small>
        `;

        postContainer.appendChild(postElement);
    });
}

async function fetchCategories(urlname) {
    try {
        const response = await fetch(`http://127.0.0.1:8000/category/?urlname=${encodeURIComponent(urlname)}`, {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${localStorage.getItem("access_token")}`,
                "Content-Type": "application/json"
            }
        });

        if (!response.ok) {
            console.error(`âŒ ì¹´í…Œê³ ë¦¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (ìƒíƒœ ì½”ë“œ: ${response.status})`);
            return;
        }

        const categories = await response.json();
        console.log("ğŸ“¢ ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë°ì´í„°:", categories);

        // âœ… UI ì—…ë°ì´íŠ¸
        updateCategoryUI(categories);
    } catch (error) {
        console.error("âŒ ì¹´í…Œê³ ë¦¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
    }
}
document.addEventListener("DOMContentLoaded", async function () {
    // âœ… URLì—ì„œ `post_id` ê°€ì ¸ì˜¤ê¸°
    const urlParams = new URLSearchParams(window.location.search);
    const postId = urlParams.get("post_id");

    if (!postId) {
        alert("ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.");
        window.history.back();
        return;
    }

    try {
        // âœ… 1. ê²Œì‹œë¬¼ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        const postResponse = await fetch(`http://127.0.0.1:8000/posts/${postId}/`, {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${localStorage.getItem("access_token")}`,
                "Content-Type": "application/json"
            }
        });

        if (!postResponse.ok) {
            alert("ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            window.history.back();
            return;
        }

        const postData = await postResponse.json();
        console.log("ğŸ“¢ ê²Œì‹œë¬¼ ìƒì„¸ ë°ì´í„°:", postData);

        // âœ… 2. `url_name` ì‚¬ìš©í•˜ì—¬ í”„ë¡œí•„ ê°€ì ¸ì˜¤ê¸°
        const postAuthorUrlname = postData.url_name;  // ğŸ”¥ ë°±ì—”ë“œì—ì„œ ë°›ì€ url_nameì„ ì‚¬ìš©
        console.log("ğŸ”¹ ê²Œì‹œë¬¼ ì‘ì„±ìì˜ URL Name:", postAuthorUrlname);

        if (!postAuthorUrlname) {
            console.error("âŒ ê²Œì‹œë¬¼ ì‘ì„±ìì˜ url_nameì´ ì—†ìŠµë‹ˆë‹¤.");
            alert("ê²Œì‹œë¬¼ ì‘ì„±ìì˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.");
            return;
        }

        // âœ… 3. ê¸€ì“´ì´ì˜ í”„ë¡œí•„ ê°€ì ¸ì˜¤ê¸°
        const profileData = await fetchAPI(`profile/${encodeURIComponent(postAuthorUrlname)}/`);
        if (!profileData) {
            console.error("âŒ ê²Œì‹œë¬¼ ì‘ì„±ìì˜ í”„ë¡œí•„ì„ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }

        // âœ… 4. ê¸€ì“´ì´ì˜ ì„œë¡œì´ì›ƒ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        const neighborResponse = await fetch(`http://127.0.0.1:8000/profile/${encodeURIComponent(postAuthorUrlname)}/neighbors/`, {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${localStorage.getItem("access_token")}`,
                "Content-Type": "application/json"
            }
        });

        let neighborUsernames = [];
        if (neighborResponse.ok) {
            const neighborData = await neighborResponse.json();
            neighborUsernames = neighborData.neighbors.map(n => n.urlname);
        }

        console.log("ğŸ”¹ ê¸€ì“´ì´ì˜ ì„œë¡œì´ì›ƒ ëª©ë¡ (urlname ê¸°ì¤€):", neighborUsernames);

        // âœ… 5. ê¸€ì“´ì´ì˜ ì¹´í…Œê³ ë¦¬ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        const categoryResponse = await fetch(`http://127.0.0.1:8000/category/?urlname=${encodeURIComponent(postAuthorUrlname)}`, {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${localStorage.getItem("access_token")}`,
                "Content-Type": "application/json"
            }
        });

        let categories = [];
        if (categoryResponse.ok) {
            categories = await categoryResponse.json();
            console.log("ğŸ“¢ ì¹´í…Œê³ ë¦¬ ëª©ë¡:", categories);
        } else {
            console.error("âŒ ì¹´í…Œê³ ë¦¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }

        // âœ… 6. ì¹´í…Œê³ ë¦¬ UI ì—…ë°ì´íŠ¸
        updateCategoryUI(categories);

        // âœ… 7. UI ì—…ë°ì´íŠ¸ (ğŸ”¹ ê¸€ì“´ì´ì˜ ì •ë³´ë¡œ ì—…ë°ì´íŠ¸!)
        updateBlogUI(profileData);
        updatePostDetailUI(postData, neighborUsernames);

    } catch (error) {
        console.error("âŒ ì„œë²„ ì—°ê²° ì˜¤ë¥˜:", error);
        alert("ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
    }
});

// âœ… ì¹´í…Œê³ ë¦¬ UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updateCategoryUI(categories) {
    const categoryListContainer = document.getElementById("categoryList");

    if (!categoryListContainer) {
        console.error("âŒ 'categoryList' ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    categoryListContainer.innerHTML = ""; // ê¸°ì¡´ ëª©ë¡ ì´ˆê¸°í™”

    if (!categories || categories.length === 0) {
        categoryListContainer.innerHTML = "<li>ì¹´í…Œê³ ë¦¬ê°€ ì—†ìŠµë‹ˆë‹¤.</li>";
        return;
    }

    categories.forEach(category => {
        const li = document.createElement("li");
        li.textContent = category.name;  // ê° ì¹´í…Œê³ ë¦¬ ì´ë¦„ì„ í•œ ì¤„ì”© í‘œì‹œ
        li.style.display = "block";  // ìŠ¤íƒ€ì¼ì„ blockìœ¼ë¡œ ì§€ì •í•´ì„œ í•œ ì¤„ì”© ë‚˜ì˜¤ë„ë¡ ì„¤ì •
        categoryListContainer.appendChild(li);  // ë¦¬ìŠ¤íŠ¸ í•­ëª©ì„ ì¶”ê°€
    });
}






// âœ… ë¸”ë¡œê·¸ UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ê¸€ì“´ì´ ê¸°ì¤€ìœ¼ë¡œ ë³€ê²½)
function updateBlogUI(profileData) {
    if (!profileData) {
        console.error("âŒ ë¸”ë¡œê·¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }

    const nicknameElement = document.querySelector(".user-nickname");
    const profileImageElement = document.querySelector(".user-profilepicture");
    const blogIntroElement = document.querySelector(".itemfont_col");

    if (nicknameElement) {
        nicknameElement.innerText = profileData.username;
    } else {
        console.error("âŒ ë‹‰ë„¤ì„ì„ í‘œì‹œí•  ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }

    if (profileImageElement) {
        profileImageElement.src = profileData.user_pic;
    }

    if (blogIntroElement) {
        blogIntroElement.innerText = profileData.intro || "";
    }
}



// ê¸€ì“´ ì‚¬ëŒì˜ í”„ë¡œí•„ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
async function updateProfileUI(postUserUrlname) {
    const profileData = await fetchAPI(`profile/${encodeURIComponent(postUserUrlname)}/`);

    if (profileData) {
        // í”„ë¡œí•„ ì—…ë°ì´íŠ¸
        document.querySelector(".user-nickname").innerText = profileData.username || "ìµëª…";
        document.querySelector(".user-profilepicture").src = profileData.user_pic || "assets/profile.png";
        document.querySelector(".itemfont_col").innerText = profileData.intro || "ë¸”ë¡œê·¸ ì†Œê°œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.";
    } else {
        console.error("âŒ ê¸€ì“´ ì‚¬ëŒì˜ í”„ë¡œí•„ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    }
}


// âœ… ê²Œì‹œë¬¼ ìƒì„¸ UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (ë³¸ë¬¸ & í”„ë¡œí•„ ì—…ë°ì´íŠ¸ í¬í•¨)
async function updatePostDetailUI(postData) {
    const postCategoryElement = document.querySelector(".post-category");  
    const postTitleElement = document.querySelector(".post-title");  
    const postAuthorElement = document.querySelector(".post-author");  
    const postDateElement = document.querySelector(".post-date");  
    const postMutualElement = document.querySelector(".post-mutual");  
    const postRangeElement = document.querySelector(".post-range"); // ğŸ”¹ ê³µê°œ ë²”ìœ„ (ë°•ìŠ¤)
    const postContentElement = document.querySelector(".post-content"); // ğŸ”¹ ë³¸ë¬¸ ì˜ì—­

    // âœ… ê²Œì‹œë¬¼ ë°ì´í„° ì—…ë°ì´íŠ¸
    postTitleElement.textContent = postData.title;
    postAuthorElement.textContent = postData.user_name;  
    postDateElement.textContent = formatDate(postData.created_at);
    postCategoryElement.textContent = postData.category_name; // ì¹´í…Œê³ ë¦¬ëŠ” ê·¸ëŒ€ë¡œ í…ìŠ¤íŠ¸ë§Œ í‘œì‹œ

    // âœ… ê²Œì‹œê¸€ ì‘ì„±ìì˜ í”„ë¡œí•„ ì—…ë°ì´íŠ¸
    const postUserUrlname = postData.user_urlname || postData.user_name;
    await updateProfileUI(postUserUrlname);  // ğŸ”¥ ê¸€ì“´ ì‚¬ëŒì˜ í”„ë¡œí•„ ë¶ˆëŸ¬ì™€ì„œ ì—…ë°ì´íŠ¸

    // âœ… ê²Œì‹œë¬¼ ê³µê°œ ë²”ìœ„ ì„¤ì • (visibility) ë°•ìŠ¤ë¡œ í‘œì‹œ
    let visibilityText = "";
    let visibilityClass = "";
    if (postData.visibility === "everyone") {
        visibilityText = "ì „ì²´";
        visibilityClass = "post-range everyone";
    } else if (postData.visibility === "mutual") {
        visibilityText = "ì„œë¡œì´ì›ƒ";
        visibilityClass = "post-range mutual";
    } else if (postData.visibility === "me") {
        visibilityText = "ë‚˜ë§Œ ë³´ê¸°";
        visibilityClass = "post-range me";
    }
    postRangeElement.textContent = visibilityText;
    postRangeElement.className = visibilityClass; // í´ë˜ìŠ¤ ì ìš©í•´ì„œ ìŠ¤íƒ€ì¼ ë°˜ì˜

    // âœ… ê²Œì‹œë¬¼ ë³¸ë¬¸ í‘œì‹œ ì˜¤ë¥˜ í•´ê²°
    if (!postData.content || postData.content.trim() === "") {
        postContentElement.innerHTML = "<p style='color: gray;'>ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</p>";  // ê¸°ë³¸ ë©”ì‹œì§€ ì œê³µ
    } else {
        postContentElement.innerHTML = cleanContent(postData.content);  // ë³¸ë¬¸ í‘œì‹œ
    }
}


// âœ… ë‚ ì§œ í¬ë§· ë³€í™˜ í•¨ìˆ˜
function formatDate(dateString) {
    const dateObj = new Date(dateString);
    return `${dateObj.getFullYear()}. ${dateObj.getMonth() + 1}. ${dateObj.getDate()} ${dateObj.getHours()}:${String(dateObj.getMinutes()).padStart(2, '0')}`;
}

// âœ… ë¶ˆí•„ìš”í•œ HTML íƒœê·¸ ì œê±° í•¨ìˆ˜
function cleanContent(content) {
    return content
        .replace(/ëŒ€í‘œì‚¬ì§„ ì„ íƒ/g, "") // 'ëŒ€í‘œ ì‚¬ì§„ ì„ íƒ' ì œê±°
        .replace(/ì´ë¯¸ì§€ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”\.\.\./g, "") // 'ì´ë¯¸ì§€ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”...' ì œê±°
        .trim();
}
    </script>
  </body>
</html>